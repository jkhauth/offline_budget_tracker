(()=>{"use strict";let e;const t=indexedDB.open("budget",1);function n(){const t=e.transaction(["pending"],"readwrite").objectStore("pending").getAll();t.onsuccess=function(){t.result.length>0&&fetch("/api/transaction/bulk",{method:"POST",body:JSON.stringify(t.result),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}}).then((e=>e.json())).then((()=>{e.transaction(["pending"],"readwrite").objectStore("pending").clear()}))}}t.onupgradeneeded=function(e){e.target.result.createObjectStore("pending",{autoIncrement:!0})},t.onsuccess=function(t){e=t.target.result,navigator.onLine&&n()},t.onerror=function(e){console.log("Oh NO! "+e.target.errorCode)},window.addEventListener("online",n);const a=e=>{let t=e.reduce(((e,t)=>e+parseInt(t.value)),0);document.querySelector("#total").textContent=t};function o(e){let t=document.querySelector("#tbody");t.innerHTML="",e.forEach((e=>{let n=document.createElement("tr");n.innerHTML="\n      <td id='date'>".concat(e.date.slice(5,7),"/").concat(e.date.slice(8,10),"/").concat(e.date.slice(2,4),"</td>\n      <td>").concat(e.name,"</td>\n      <td>").concat(e.category.replace(/(^\w{1})|(\s+\w{1})/g,(e=>e.toUpperCase())),"</td>\n      <td>$").concat(e.value,"</td>\n    "),t.appendChild(n)}))}let c,r;const l=e=>{let t=e.slice().reverse(),n=0,a=t.map((e=>{let t=new Date(e.date);return"".concat(t.getMonth()+1,"/").concat(t.getDate(),"/").concat(t.getFullYear())})),o=t.map((e=>(n+=parseInt(e.value),n)));c&&c.destroy();let r=document.getElementById("myChart").getContext("2d");c=new Chart(r,{type:"line",data:{labels:a,datasets:[{label:"Total Over Time",fill:!0,backgroundColor:"#e0afa0",data:o}]},options:{responsive:!0}})},i=e=>{let t=[];e.forEach((e=>{"income"!==e.category&&t.push({[e.category]:e.value})}));const n=t.reduce(((e,t)=>{for(const[n,a]of Object.entries(t))e[n]||(e[n]=0),e[n]+=a;return e}),{});r&&r.destroy();const a=document.getElementById("myDonut").getContext("2d");r=new Chart(a,{type:"doughnut",data:{labels:Object.keys(n).reverse(),datasets:[{label:"Total Spending by Category",backgroundColor:["#463f3a","#8a817c","#758b69","#bcb8b1","#4f0113","#b991c9","#e0afa0","#c6949a","#a27f93","#7a6c86","#525a72","#2f4858","#006796","#546fa7","#9177a9","#ba84a4","#d4979e","#aac19d","#e56d4b","#f4f3ee"],data:Object.values(n).reverse()}]},options:{title:{display:!0,text:"Total Spending by Category"}}})};let d=[];(async()=>{try{const e=await fetch("/api/transaction");d=await e.json(),a(d),o(d),l(d),i(d)}catch(e){}})();const s=t=>{let n=document.querySelector("#t-name"),c=document.querySelector("#t-cat"),r=document.querySelector("#t-amount"),s=document.querySelector(".form .error");if(""===n.value||""===c.value||""===r.value)return void(s.textContent="Missing Information");s.textContent="";let u={name:n.value,category:c.value.trim().toLowerCase(),value:r.value,date:(new Date).toISOString()};t||(u.value*=-1),d.unshift(u),l(d),i(d),o(d),a(d),(async()=>{try{const e=await fetch("/api/transaction",{method:"POST",body:JSON.stringify(u),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}});(await e.json()).errors?s.textContent="Missing Information":n.value="",c.value="",r.value=""}catch(a){t=u,e.transaction(["pending"],"readwrite").objectStore("pending").add(t),n.value="",c.value="",r.value=""}var t})()};document.querySelector("#add-btn").onclick=function(){s(!0)},document.querySelector("#sub-btn").onclick=function(){s(!1)}})();