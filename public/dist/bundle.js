(()=>{"use strict";let t;const e=indexedDB.open("budget",1);function n(){const e=t.transaction(["pending"],"readwrite").objectStore("pending").getAll();e.onsuccess=function(){e.result.length>0&&fetch("/api/transaction/bulk",{method:"POST",body:JSON.stringify(e.result),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}}).then((t=>t.json())).then((()=>{t.transaction(["pending"],"readwrite").objectStore("pending").clear()}))}}e.onupgradeneeded=function(t){t.target.result.createObjectStore("pending",{autoIncrement:!0})},e.onsuccess=function(e){t=e.target.result,navigator.onLine&&n()},e.onerror=function(t){console.log("Oh NO! "+t.target.errorCode)},window.addEventListener("online",n);const a=t=>{let e=t.reduce(((t,e)=>t+parseInt(e.value)),0);document.querySelector("#total").textContent=e};let o,c;const r=t=>{let e=t.slice().reverse(),n=0,a=e.map((t=>{let e=new Date(t.date);return"".concat(e.getMonth()+1,"/").concat(e.getDate(),"/").concat(e.getFullYear())})),c=e.map((t=>(n+=parseInt(t.value),n)));o&&o.destroy();let r=document.getElementById("myChart").getContext("2d");o=new Chart(r,{type:"line",data:{labels:a,datasets:[{label:"Total Over Time",fill:!0,backgroundColor:"#e0afa0",data:c}]},options:{responsive:!0}})},i=t=>{let e=[];t.forEach((t=>{"income"!==t.category&&e.push({[t.category]:t.value})}));const n=e.reduce(((t,e)=>{for(const[n,a]of Object.entries(e))t[n]||(t[n]=0),t[n]+=a;return t}),{});c&&c.destroy();const a=document.getElementById("myDonut").getContext("2d");c=new Chart(a,{type:"doughnut",data:{labels:Object.keys(n).reverse(),datasets:[{label:"Total Spending by Category",backgroundColor:["#463f3a","#8a817c","#758b69","#bcb8b1","#4f0113","#b991c9","#e0afa0","#c6949a","#a27f93","#7a6c86","#525a72","#2f4858","#006796","#546fa7","#9177a9","#ba84a4","#d4979e","#aac19d","#e56d4b","#f4f3ee"],data:Object.values(n).reverse()}]},options:{title:{display:!0,text:"Total Spending by Category",responsive:!0}}})},d=document.getElementById("tbody");let s,l,u;const p=(e,n)=>{let o=document.querySelector("#t-name"),c=document.querySelector("#t-cat"),d=document.querySelector("#t-amount"),s=document.querySelector(".form .error");if(""===o.value||""===c.value||""===d.value)return void(s.textContent="Missing Information");s.textContent="";let l={name:o.value.trim(),category:c.value.trim().toLowerCase(),value:d.value,date:(new Date).toISOString()};e||(l.value*=-1),n.unshift(l),r(n),i(n),y(n),a(n),(async()=>{try{const t=await fetch("/api/transaction",{method:"POST",body:JSON.stringify(l),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}});(await t.json()).errors?s.textContent="Missing Information":o.value="",c.value="",d.value=""}catch(n){e=l,t.transaction(["pending"],"readwrite").objectStore("pending").add(e),o.value="",c.value="",d.value=""}var e})()};function y(t){d.innerHTML="",t.forEach((t=>{let e=document.createElement("tr");e.setAttribute("class","table-row"),e.innerHTML="\n            <td id=".concat(t._id,' data-type="date" class="td-data">\n                ').concat(t.date.slice(5,7),"/").concat(t.date.slice(8,10),"/").concat(t.date.slice(2,4),"\n            </td>\n            <td id=").concat(t._id,' data-type="name" class="td-data">\n                ').concat(t.name,"\n            </td>\n            <td id=").concat(t._id,' data-type="category" class="td-data">\n                ').concat(t.category.replace(/(^\w{1})|(\s+\w{1})/g,(t=>t.toUpperCase())),"\n            </td>\n            <td id=").concat(t._id,' data-type="value" class="td-data">$').concat(t.value,"\n                <span id=").concat(t._id,' class="delete">\n                    <i class="fa fa-times" aria-hidden="true"></i>\n                </span>\n            </td>\n        '),d.appendChild(e)}))}let g=[];(async()=>{try{const t=await fetch("/api/transaction");g=await t.json(),a(g),y(g),r(g),i(g)}catch(t){}})(),document.querySelector("#add-btn").onclick=function(){p(!0,g)},document.querySelector("#sub-btn").onclick=function(){p(!1,g)},d.addEventListener("click",(t=>{navigator.onLine&&(t=>{const e=t.target.closest("td");if("date"===e.dataset.type)return;void 0!==s&&(s.parentElement.innerHTML=l);const n=e.innerHTML,a=e.parentElement,o='<input type="text" id="'.concat(a.rowIndex," ").concat(e.cellIndex,'" size="10"/>');l=n,e.innerHTML=o,u=document.getElementById("".concat(a.rowIndex," ").concat(e.cellIndex)),s=u,u.focus(),u.addEventListener("keypress",(function(t){if("Enter"===t.key){let t;switch(e.dataset.type){case"name":t={name:u.value.trim()};break;case"category":t={category:u.value.trim().toLowerCase()};break;case"value":t={value:u.value}}(async()=>{try{const n=await fetch("/api/transaction/".concat(e.id),{method:"PUT",body:JSON.stringify(t),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}});await n.json()}catch(t){}})(),location.reload()}}))})(t)})),document.addEventListener("click",(t=>{(t=>{d.contains(t.target)||void 0===s||(u.parentElement.innerHTML=l,l=void 0,s=void 0)})(t)})),d.addEventListener("click",(t=>{(t=>{if("I"===t.target.tagName){let e=t.target.parentNode.id;(async()=>{try{const t=await fetch("/api/transaction/".concat(e),{method:"DELETE",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}});await t.json()}catch(t){}})(),location.reload()}})(t)}))})();